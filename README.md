# Wall Detection - Распознавание стен из планов квартир

Проект для автоматического распознавания архитектурных стен на планах квартир и преобразования их в структурированный JSON формат.

## Цель

Преобразовать изображение плана квартиры (JPG/PNG) в структурированные данные с координатами стен в формате JSON с параллельной визуализацией результатов.

## Структура проекта

wall-detection/
├── data/
│   ├── input/           # Входные изображения (JPG/PNG)
│   └── output/          # Результаты (JSON + изображения)
├── main.py              # Основной код детектора
└── README.md            # Эта документация

## Быстрый старт

### 1. Установка зависимостей
pip install opencv-python numpy Pillow

### 2. Подготовка данных
Поместите изображения планов квартир в папку `data/input/`

### 3. Запуск обработки
python src/main.py

### 4. Результаты
Результаты сохраняются в `data/output/`:
- `имя_файла.json` - структурированные данные о стенах
- `имя_файла_detected.png` - визуализация найденных стен

## Технический стек

### Используемые инструменты и библиотеки:

1. **OpenCV (cv2)** - основной инструмент компьютерного зрения
   - Причина выбора: надежная библиотека для обработки изображений, детекции линий и морфологических операций
   - Ключевые функции: `HoughLinesP`, адаптивная бинаризация, морфологические операции

2. **NumPy** - работа с массивами и математические операции
   - Причина выбора: эффективные численные вычисления и работа с изображениями как с массивами

3. **Pillow (PIL)** - базовые операции с изображениями
   - Причина выбора: простой интерфейс для загрузки/сохранения изображений

### Почему НЕ использовались нейросети:
- Нет необходимости в обучающих данных
- Быстрее и проще в настройке для детекции прямых линий
- Меньше зависимостей и требований к железу

## Пайплайн обработки

### Этап 1: Загрузка и предобработка изображения
- Загрузка изображения в оттенки серого
- Улучшение контраста с помощью CLAHE
- Адаптивная бинаризация для выделения линий
- Морфологические операции для удаления шума

### Этап 2: Детекция линий
- Преобразование Хафа (HoughLinesP) для детекции прямых линий
- Фильтрация по минимальной длине (настраиваемый параметр)
- Оценка толщины линий для отсечения тонких (не-стен)

### Этап 3: Постобработка
- Объединение близких и коллинеарных стен
- Фильтрация дубликатов
- Адаптивная фильтрация по толщине в зависимости от длины

### Этап 4: Форматирование вывода
- Преобразование координат в JSON формат
- Сохранение статистики обработки
- Генерация визуализации с выделенными стенами

## Формат вывода

### JSON файл:
{
  "meta": {
    "source": "plan.png",
    "processing_date": "2024-01-15T12:30:45",
    "image_size": {"width": 800, "height": 600}
  },
  "detection_params": {
    "min_wall_length": 50,
    "merge_distance": 15,
    "min_thickness": 0.5
  },
  "statistics": {
    "total_walls": 24,
    "avg_wall_length": 120.5,
    "avg_thickness": 0.65
  },
  "walls": [
    {
      "id": "w1",
      "points": [[100, 150], [300, 150]],
      "length": 200.0,
      "thickness": 0.7
    }
  ]
}

### Визуализация:
Создается изображение с выделенными синим цветом стенами и статистикой в левом верхнем углу.

## Настраиваемые параметры

В классе `WallDetector` можно настроить:

detector = WallDetector(
    min_wall_length=50,      # Минимальная длина стены в пикселях
    merge_distance=15,       # Расстояние для объединения близких стен
    min_thickness=0.5        # Минимальная толщина (0-1)
)

## Слабые места текущей реализации

### 1. Чувствительность к качеству изображения
- Плохо работает с фотографиями (перспективные искажения, тени)
- Требует четких чертежей с хорошим контрастом

### 2. Ограничения детекции
- Не различает несущие стены и перегородки
- Проблемы с изогнутыми стенами
- Не детектирует окна и двери

### 3. Параметрическая зависимость
- Требует ручной настройки параметров под разные стили чертежей
- Чувствительность к толщине линий на исходном изображении

### 4. Геометрические ограничения
- Работает только с прямыми стенами
- Координаты в пикселях, а не в реальных единицах измерения

## Планы по улучшению

### Для следующей итерации:

### 1. Улучшение детекции
- **Добавление сегментации U-Net/DeepLab** для лучшего выделения стен
- **Внедрение SAM (Segment Anything Model)** для семантической сегментации
- **Детекция дверей и окон** с помощью YOLO или Faster R-CNN

### 2. Обработка сложных случаев
- **Коррекция перспективы** для фотографий планов
- **OCR модуль** для распознавания размеров и обозначений
- **Распознавание изогнутых стен** через полилинии

### 3. Улучшение вывода
- **Конвертация в реальные единицы измерения** (метры, сантиметры)
- **Генерация 3D моделей** из 2D планов
- **Экспорт в форматы** (DXF, SVG, IFC)

### 4. Автоматизация
- **Автоматическая настройка параметров** под стиль чертежа
- **Пакетная обработка** больших объемов данных
- **Веб-интерфейс** для загрузки и просмотра результатов

### 5. Производительность
- **Оптимизация кода** с использованием C++ расширений
- **Поддержка GPU** для нейросетевых компонентов
- **Потоковая обработка** нескольких изображений

## Использование в продакшене

Для промышленного использования рекомендуется:

1. **Создание тренировочного датасета** из разнообразных планов
2. **Обучение custom модели** для сегментации стен
3. **Реализация REST API** для интеграции с другими системами
4. **Добавление валидации** и контроля качества результатов
---

Проект демонстрирует подход к решению задачи компьютерного зрения без использования нейросетей, что делает его легковесным и быстрым для прототипирования.
